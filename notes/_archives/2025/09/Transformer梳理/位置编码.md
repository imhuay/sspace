ä½ç½®ç¼–ç  (Position Encoding)
===
<!--START_SECTION:badge-->
![create date](https://img.shields.io/static/v1?label=create%20date&message=2025-09-09&label_color=gray&color=lightsteelblue&style=flat-square)
![last modify](https://img.shields.io/static/v1?label=last%20modify&message=2025-09-12%2000%3A14%3A55&label_color=gray&color=thistle&style=flat-square)
<!--END_SECTION:badge-->
<!--info
date: 2025-09-09 11:03:29
toc_title: ä½ç½®ç¼–ç  (PE)
top: false
draft: false
hidden: false
level: 0
tag: [dl_transformer]
-->

<!--START_SECTION:keywords-->
> ***Keywords**: [Transformer](./README.md)*
<!--END_SECTION:keywords-->

<!--START_SECTION:paper_title-->
<!--END_SECTION:paper_title-->

<!--START_SECTION:toc-->
- [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
- [ç»å¯¹ä½ç½®ç¼–ç ](#ç»å¯¹ä½ç½®ç¼–ç )
    - [æ­£å¼¦ä½ç½®ç¼–ç ](#æ­£å¼¦ä½ç½®ç¼–ç )
    - [å¯å­¦ä¹ ä½ç½®ç¼–ç ](#å¯å­¦ä¹ ä½ç½®ç¼–ç )
- [ç›¸å¯¹ä½ç½®ç¼–ç ](#ç›¸å¯¹ä½ç½®ç¼–ç )
    - [SHAW](#shaw)
    - [XLNet](#xlnet)
    - [T5](#t5)
    - [DeBERTa](#deberta)
    - [ALiBi](#alibi)
- [æ—‹è½¬ä½ç½®ç¼–ç  ğŸ”¥](#æ—‹è½¬ä½ç½®ç¼–ç -)
- [å‚è€ƒèµ„æ–™](#å‚è€ƒèµ„æ–™)
    - [é¢è¯•é—®é¢˜æ•´ç†](#é¢è¯•é—®é¢˜æ•´ç†)
<!--END_SECTION:toc-->

---

## æ ¸å¿ƒæ¦‚å¿µ

- **åŠ¨æœº**:
    - è‡ªæ³¨æ„åŠ›çš„æœ¬è´¨æ˜¯ **åŠ æƒæ±‚å’Œ**, åœ¨æ•°å­¦ä¸Šæ˜¯ä¸€ç§ **é›†åˆ** æ“ä½œ, å…·æœ‰ **ç½®æ¢ç­‰å˜æ€§ (Permutation Equivariant)**;
    - è¿™æ„å‘³ç€ **å³ä½¿æ‰“ä¹±è¾“å…¥åºåˆ—çš„é¡ºåº, æ³¨æ„åŠ›æœºåˆ¶ä¹Ÿä¼šäº§ç”Ÿç›¸åŒçš„åˆ†å¸ƒ**;
        > [æµ‹è¯•ç½®æ¢ç­‰å˜æ€§.py](./code/test_permutation.py)
    - ä¸ºäº†ä½¿å…¶èƒ½å¤Ÿç†è§£åºåˆ—çš„ **é¡ºåº** æ¦‚å¿µ, å¿…é¡»æ˜¾å¼å¼•å…¥ **ä½ç½®ä¿¡æ¯**;
- **æ–¹æ³•** (å¦‚ä½•å¼•å…¥ä½ç½®ä¿¡æ¯)
    1. åœ¨è¾“å…¥æ¨¡å‹å‰, å¯¹è¯åµŒå…¥æ–½åŠ ä½ç½®ç¼–ç  (å¦‚ **æ­£å¼¦ä½ç½®ç¼–ç **);
    2. åœ¨è®¡ç®—æ³¨æ„åŠ›å‰, å¯¹ Q/K æ–½åŠ å˜æ¢ (å¦‚ **RoPE**);
    3. åœ¨å¾—åˆ°æ³¨æ„åŠ›å, å¯¹ logits æ–½åŠ åç½® (å¦‚ **ALiBi**);
- **ç†æƒ³å±æ€§**
    - **å”¯ä¸€æ€§**: æ¯ä¸ªä½ç½®çš„ç¼–ç å”¯ä¸€ (æ‰€æœ‰ä½äºä½ç½® $i$ çš„ token æœ‰ç›¸åŒçš„ç¼–ç )
    - **ç¡®å®šæ€§**: ç”±ç¡®å®šæ€§å…¬å¼æˆ–ç®—æ³•ç”Ÿæˆ, ä¾¿äºæ¨¡å‹å­¦ä¹ /æ³›åŒ–;
    - **å¤–æ¨æ€§ (Extrapolation)**: èƒ½æ³›åŒ–åˆ°æ¯”è®­ç»ƒåºåˆ—æ›´é•¿çš„è¾“å…¥;
    - **ç›¸å¯¹ä½ç½®æ„ŸçŸ¥**: ä¸¤ä¸ªä½ç½®ç¼–ç ä¹‹é—´åº”è¯¥è•´å« **ç›¸å¯¹ä½ç½®** ä¿¡æ¯, å¹¶å…·æœ‰ç®€å•çš„æ•°å­¦å…³ç³» (æœ€å¥½æ˜¯çº¿æ€§çš„);
    - **è·ç¦»è¡°å‡**: è·ç¦»è¶Šè¿œçš„ä¸¤ä¸ªä½ç½®, æ³¨æ„åŠ›è¶Šå¼±;
    - **æ‰©å±•æ€§**: èƒ½è‡ªç„¶æ‰©å±•åˆ°å¤šç»´æ•°æ® (å›¾åƒ, è§†é¢‘);

## ç»å¯¹ä½ç½®ç¼–ç 

### æ­£å¼¦ä½ç½®ç¼–ç 

- **æ¥æº/ä½¿ç”¨æ¨¡å‹**: Transformer åŸç‰ˆ
- **æ€è·¯/åŸç†**: ä½¿ç”¨å…·æœ‰å›ºå®šæ¨¡å¼çš„ä¸‰è§’å‡½æ•°ä¸ºæ¯ä¸ªä½ç½®ç”Ÿæˆç‹¬ä¸€æ— äºŒçš„ç¼–ç å‘é‡;
- **å…¬å¼**:
    - $PE_{(pos, 2i)} = \sin(\dfrac{pos}{10000^{2i/d_{model}}}), \hspace{1em} PE_{(pos, 2i+1)} = \cos(\dfrac{pos}{10000^{2i/d_{model}}})$
    - å…¶ä¸­
        - $pos$ æ˜¯ token çš„ä½ç½®ç´¢å¼• (ä» $0$ åˆ° `max_len`);
        - $i$ æ˜¯ç¼–ç å‘é‡çš„ç»´åº¦ç´¢å¼• (ä» $0$ åˆ° $d_{model}-1$);
        - $d_{model}$ æ˜¯ç¼–ç å‘é‡çš„æ€»ç»´åº¦;
    - ç”Ÿæˆè¿‡ç¨‹:
        ```python
        # max_len, d_model = 3, 4

        # 1. åˆå§‹åŒ–ä¸€ä¸ªå…¨é›¶çš„ä½ç½®ç¼–ç çŸ©é˜µ [max_len, d_model]
        pe = np.zeros((max_len, d_model))

        # 2. ç”Ÿæˆä½ç½®åºåˆ— [0, 1, 2, ..., max_len-1], å¹¶è½¬æ¢ä¸ºåˆ—å‘é‡ [max_len, 1]
        pos = np.arange(0, max_len).reshape(-1, 1)

        # 3. è®¡ç®—åˆ†æ¯ä¸­çš„é¡¹ (å–å€’æ•°): inv = 10000^(-2i/d_model)
        #    å…¬å¼: 10000^(-2i/d_model) ç­‰ä»·äº exp( (-2i / d_model * log(10000)))
        inv = np.exp(np.arange(0, d_model, 2) * (-np.log(10000.0) / d_model))

        # 4. å¯¹å¶æ•°ç´¢å¼• (2i) ä½ç½®åº”ç”¨æ­£å¼¦å‡½æ•°, å¥‡æ•°ç´¢å¼• (2i+1) ä½ç½®åº”ç”¨ä½™å¼¦å‡½æ•°
        pe[:, 0::2] = np.sin(pos * inv)
        pe[:, 1::2] = np.cos(pos * inv)
        ```
- **ä¼˜ç‚¹**:
    - å”¯ä¸€, ç¡®å®š, æ— éœ€å­¦ä¹  (èŠ‚çœå‚æ•°);
    - å…·å¤‡ä¸€å®šçš„ **å¤–æ¨èƒ½åŠ› (extrapolation)**, å¯å¤„ç†æ¯”è®­ç»ƒæ›´é•¿çš„åºåˆ—;
    - å…¶æ•°å­¦ç‰¹æ€§ **è•´å«ç›¸å¯¹ä½ç½®ä¿¡æ¯**, å³ $PE(pos+k)$ å¯è¡¨ç¤ºä¸º $PE(pos)$ çš„çº¿æ€§å‡½æ•°;
- **ç¼ºç‚¹**:
    - å¤–æ¨èƒ½åŠ›æœ‰é™/æ•ˆæœä¸ä½³;
- **æ‹“å±•**:
    - æ­£å¼¦ä½ç½®ç¼–ç ä¸­çš„ "æ³¢é•¿" æ˜¯ä»€ä¹ˆæ„æ€? ä¸åŒç»´åº¦å¯¹åº”çš„æ³¢é•¿æœ‰ä½•ä¸åŒ?
        > æ³¢é•¿ $\lambda$ ç”±å…¬å¼ä¸­çš„ $10000^{2i/d_{model}}$ å†³å®š. éšç€ç»´åº¦ $i$ ä» $0$ å¢åŠ åˆ° $d_{model}/2 - 1$, æ³¢é•¿ä» $2Ï€$ (é«˜é¢‘, å˜åŒ–å¿«) å¢é•¿åˆ° $10000 * 2Ï€$ (ä½é¢‘, å˜åŒ–æ…¢); **è¿™ä½¿æ¨¡å‹èƒ½åŒæ—¶æ•è·è¿‘è·ç¦»å’Œè¿œè·ç¦»çš„ä½ç½®å…³ç³»**.

### å¯å­¦ä¹ ä½ç½®ç¼–ç 

- **æ¥æº/ä½¿ç”¨æ¨¡å‹**: BERT
- **æ–¹æ³•**: éšæœºåˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸º `(max_seq_len, d_model)` çš„çŸ©é˜µä½œä¸ºä½ç½®ç¼–ç å‚æ•°, ç„¶åä¸æ¨¡å‹çš„å…¶ä»–å‚æ•°ä¸€èµ·é€šè¿‡è®­ç»ƒå­¦ä¹ å¾—åˆ°;
- **ä¼˜ç‚¹**:
    - çµæ´», å¯èƒ½å­¦åˆ°æ›´é€‚åˆç‰¹å®šä»»åŠ¡çš„ä½ç½®æ¨¡å¼;
- **ç¼ºç‚¹**:
    - **ä¸å…·å¤‡å¤–æ¨èƒ½åŠ›** (å†…æ’), ä¸¥æ ¼ä¾èµ–äºè®­ç»ƒæ—¶è§è¿‡çš„ä½ç½® (`max_len`);
    - å¢åŠ äº†æ¨¡å‹å‚æ•°é‡;

## ç›¸å¯¹ä½ç½®ç¼–ç 

- **æ¥æº**: Shaw et al., XLNet, T5, DeBERTa, ALiBi
- **æ€è·¯**: å¯¹ **å¸¦æœ‰ç»å¯¹ä½ç½®ç¼–ç ** çš„ Attention æ‰“åˆ†å…¬å¼è¿›è¡Œå±•å¼€, å¹¶é€šè¿‡ **ä¿®æ”¹å…¶ä¸­çš„åˆ†é¡¹** æ¥å¼•å…¥ç›¸å¯¹ä½ç½®ä¿¡æ¯;
    - å¸¦ç»å¯¹ä½ç½®ç¼–ç çš„æ³¨æ„åŠ›æ‰“åˆ†å…¬å¼ä¸º:
        $$
        q_i k_j^\top = (x_i W_Q + p_i W_Q)(x_j W_K + p_j W_K)^\top
        $$
    - å±•å¼€:
        $$
        q_i k_j^\top
            = \underbrace{x_i W_Q W_K^\top x_j^\top}_{\text{1.è¾“å…¥â€“è¾“å…¥}}
            + \underbrace{x_i W_Q W_K^\top p_j^\top}_{\text{2.è¾“å…¥â€“ä½ç½®}}
            + \underbrace{p_i W_Q W_K^\top x_j^\top}_{\text{3.ä½ç½®â€“è¾“å…¥}}
            + \underbrace{p_i W_Q W_K^\top p_j^\top}_{\text{4.ä½ç½®â€“ä½ç½®}}
        $$
- **ä¸åŒçš„ç›¸å¯¹ä½ç½®ç¼–ç å°±æ˜¯åœ¨è¿™å››é¡¹ä¸­åšåˆ å‡ã€æ›¿æ¢æˆ–ç»„åˆ**:
- **ä¼˜ç‚¹**:
    - **å¤–æ¨èƒ½åŠ›æ›´å¥½**
- **ç¼ºç‚¹**:
    - å®ç°å¤æ‚, å¢åŠ äº†è®¡ç®—å¤æ‚åº¦;

### SHAW
> SHAW æ˜¯ä½œè€…å
- **æ€è·¯**: å»æ‰ $p_i W_Q$, å¹¶å°† $p_j W_K$ æ›¿æ¢ä¸ºç›¸å¯¹ä½ç½®å‘é‡ $R^K_{i,j}$, å…¶ä¸­ $R^K_{i,j}$ ä¾èµ–äºç›¸å¯¹è·ç¦» $i-j$:
    $$
    q_i k_j^\top
        = x_i W_Q \left( x_j W_K + R^K_{i,j} \right)^\top
    $$

### XLNet
- **æ€è·¯**: å°† $p_j$ æ›¿æ¢ä¸ºç›¸å¯¹ä½ç½®å‘é‡ $R_{i-j}$, å°† $p_i$ æ›¿æ¢ä¸ºå¯è®­ç»ƒå‘é‡ $u, v$, å…¶ä¸­ $R_{i-j}$ ç”¨æ­£å¼¦ä½ç½®ç¼–ç ç”Ÿæˆ:
    $$
    q_i k_j^\top
        = x_i W_Q W_K^\top x_j^\top
        + x_i W_Q W_{K,R}^\top R_{i-j}^\top
        + u\, W_K^\top x_j^\top
        + v\, W_{K,R}^\top R_{i-j}^\top
    $$

### T5
- **æ€è·¯**: å»æ‰ **2, 3** ä¸¤é¡¹, å¹¶ç”¨å¯è®­ç»ƒåç½® $\beta_{i,j}$ ä»£æ›¿ **4** é¡¹, å…¶ä¸­ $\beta_{i,j}$ é€šè¿‡ **åˆ†æ¡¶** æ˜ å°„ç›¸å¯¹è·ç¦»åæŸ¥è¡¨å¾—åˆ°:
    $$
    q_i k_j^\top
        = x_i W_Q W_K^\top x_j^\top
        + \beta_{i,j}
    $$

### DeBERTa
- **æ€è·¯**: å»æ‰ **4** é¡¹, ä¿ç•™ **2, 3** ä¸¤é¡¹, å¹¶æ›¿æ¢ä¸ºç›¸å¯¹ä½ç½®å‘é‡, å…¶ä¸­ $R_{i,j}$ ä¾èµ–ç›¸å¯¹è·ç¦»:
    $$
    q_i k_j^\top
        = x_i W_Q W_K^\top x_j^\top
        + x_i W_Q W_K^\top R_{i,j}^\top
        + R_{j,i} W_Q W_K^\top x_j^\top
    $$

### ALiBi
- **æ€è·¯**: å»æ‰ **2, 3** ä¸¤é¡¹, å¹¶ç”¨ **å›ºå®šçº¿æ€§åç½®** ä»£æ›¿ **4** é¡¹, å…¶ä¸­ $m$ ä¸ºç¬¬ $h$ ä¸ªæ³¨æ„åŠ›å¤´çš„å¸¸æ•°æ–œç‡:
    $$
    q_i k_j^\top
        = x_i W_Q W_K^\top x_j^\top
        - m Â· (i âˆ’ j)
    $$


<!-- âœ…âŒâ­•â“âœ”ï¸â˜‘ï¸âš ï¸ğŸ”„â¡ï¸â†”ï¸ğŸ“ŒğŸ“ğŸ”–ğŸ·ï¸ğŸ’¡ğŸ“ -->
## æ—‹è½¬ä½ç½®ç¼–ç  ğŸ”¥
> RoPE, Rotary Positional Encoding
- **æ¥æº**: RoFormer
- **è®¾è®¡ç›®æ ‡**:
    - ç¼–ç æœ¬èº«èƒ½è¡¨è¾¾ token çš„ **ç»å¯¹ä½ç½®ä¿¡æ¯**;
    - åœ¨è®¡ç®—æ³¨æ„åŠ› (Query å’Œ Key çš„ç‚¹ç§¯) æ—¶, å†…ç§¯ç»“æœèƒ½å¤Ÿå¤©ç„¶ä½“ç° token ä¹‹é—´çš„ **ç›¸å¯¹ä½ç½®å…³ç³»**;
    - æ¢è¨€ä¹‹, å¦‚æœä¸¤ä¸ªå‘é‡åœ¨ç»è¿‡æŸç§ç»å¯¹ä½ç½®ç¼–ç å, å®ƒä»¬ç‚¹ç§¯çš„ç»“æœåªå–å†³äºå®ƒä»¬çš„ç›¸å¯¹ä½ç½®, é‚£ä¹ˆå°±å®ç°äº†è®¾è®¡ç›®æ ‡;
- **æ€è·¯/åŸç†/ç›´è§‰/åŠ¨æœº**:
    - æ•°å­¦ä¸Š, å¦‚æœæœ‰ä¸€ç§å˜æ¢, ä½¿å¯¹ä¸¤ä¸ªå…ƒç´  **ç›¸ä¹˜** å¯ä»¥è¡¨è¾¾æˆå®ƒä»¬ **å·®çš„å½¢å¼**, ç†è®ºä¸Šå°±è¾¾æˆäº†ç›®æ ‡;
    - **æ—‹è½¬å˜æ¢å¯ä»¥æ»¡è¶³è¿™ä¸€æ€§è´¨**;
        - å¯¹å‘é‡æ–½åŠ æ—‹è½¬, **ä¸åŒæ—‹è½¬è§’åº¦å¯ä»¥è¡¨è¾¾ç»å¯¹ä½ç½®**;
        - è€Œä¸¤ä¸ªå‘é‡ç»è¿‡æ—‹è½¬åç‚¹ç§¯, å…¶ç»“æœåªä¸å®ƒä»¬çš„ **ç›¸å¯¹ä½ç½® (æ—‹è½¬çš„è§’åº¦å·®)** æœ‰å…³, ä¸å„è‡ªå®é™…æ—‹è½¬çš„è§’åº¦æ— å…³;
    - **ç»¼ä¸Š**, é€šè¿‡å¯¹è¾“å…¥å‘é‡è¿›è¡Œ **æ—‹è½¬** å³å¯è¾¾æˆç›®æ ‡ â€”â€” **åˆ©ç”¨ç»å¯¹ä½ç½®ç¼–ç çš„æ–¹å¼, å®ç°ç›¸å¯¹ä½ç½®ç¼–ç çš„æ•ˆæœ**;
- **åšæ³•**:
    - é€šè¿‡ **æ—‹è½¬çŸ©é˜µ** å¯¹ Q/K å‘é‡è¿›è¡Œå˜æ¢, ä½¿å†…ç§¯ç»“æœ **ä»…ä¾èµ–äºç›¸å¯¹ä½ç½®**;
- **è®¡ç®—æ­¥éª¤**
    ```txt
    === RoPE è®¡ç®—æ­¥éª¤æ¼”ç¤º ===
    æ­¥éª¤ 1: å‘é‡ä¸¤ä¸¤åˆ†ç»„
    [[0.497, -0.138], [0.648, 1.523], [-0.234, -0.234]] ...

    æ­¥éª¤ 2: è®¡ç®—å„ç»„çš„æ—‹è½¬è§’åº¦, æ•°é‡ä¸º D/2
    [3.0, 0.3, 0.03] ...

    æ­¥éª¤ 3: åˆ†ç»„åº”ç”¨æ—‹è½¬
    åŸå§‹å‘é‡ (åˆ†ç»„): [[0.497, -0.138], [0.648, 1.523], [-0.234, -0.234]] ...
    æ—‹è½¬åå‘é‡ (åˆ†ç»„): [[-0.472, 0.207], [0.169, 1.646], [-0.227, -0.241]] ...
    æ—‹è½¬åå‘é‡ (å±•å¼€): [-0.472, 0.207, 0.169, 1.646, -0.227, -0.241] ...

    èŒƒæ•°æ¯”è¾ƒ
    åŸå§‹èŒƒæ•°: 2.48947373
    æ—‹è½¬åèŒƒæ•°: 2.48947373
    ```
- **æ—‹è½¬è§’åº¦** è®¡ç®—:
    - å›  **ä¸¤ä¸¤åˆ†ç»„**, å¯¹ç¬¬ $m$ å’Œ $m+1$ ä¸ª token, å…¶åœ¨ç¬¬ $i$ ä¸ªç»´åº¦ ($i \in {1,2,..,d/2}$) ä¸Šçš„æ—‹è½¬è§’åº¦ä¸º:
    $$
    \theta_i = m \cdot \dfrac{1}{10000^{2(i-1)/d}}
    $$
    - å…¶ä¸­
        - $m$ ä¸º token ä½ç½®ç´¢å¼•;
        - $i$ ä¸º å‘é‡ çš„åˆ†é‡ç´¢å¼•;
            > å…¬å¼ä¸­åŠ å…¥ $i$ çš„ä½œç”¨: è®©å‘é‡ä¸­ä¸åŒç»´åº¦çš„åˆ†é‡è´Ÿè´£ä¸åŒå°ºåº¦çš„ä½ç½®ä¿¡æ¯;
            >> - ä½ç»´ ($i$ å°): $Î¸_i$ è¾ƒå¤§ (é«˜é¢‘), æ³¢é•¿çŸ­; è¿™äº›ç»´åº¦å¯¹ä½ç½®å˜åŒ–éå¸¸æ•æ„Ÿ, æ—‹è½¬å¾ˆå¿«; å®ƒä»¬è´Ÿè´£æ•æ‰å±€éƒ¨ã€ç²¾ç»†çš„ä½ç½®å…³ç³»;  
            >> - é«˜ç»´ ($i$ å¤§): $Î¸_i$ è¾ƒå° (ä½é¢‘), æ³¢é•¿é•¿; è¿™äº›ç»´åº¦æ—‹è½¬ç¼“æ…¢, è´Ÿè´£æä¾›å…¨å±€ã€ç¨³å®šçš„ä½ç½®ä¿¡å·;
    - **ä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ $\theta$?** â€”â€” **è¿œç¨‹è¡°å‡æ€§**, å³å†…ç§¯éšç›¸å¯¹è·ç¦»å¢å¤§è€Œè¡°å‡, è¿™ä¸ **è·ç¦»è¶Šè¿œ, ä¾èµ–è¶Šå¼±** çš„ç›´è§‰ä¸€è‡´;
- **ä¼˜ç‚¹**:
    - å…·å¤‡ç»å¯¹ä½ç½®çš„å½¢å¼, äº§ç”Ÿç›¸å¯¹ä½ç½®çš„æ•ˆæœ (ä»ç»å¯¹ä½ç½®æ¨å¯¼å‡ºç›¸å¯¹å…³ç³»);
    - ä¼˜ç§€çš„ **å¤–æ¨æ€§**;
    - éšç€ç›¸å¯¹è·ç¦»çš„å¢åŠ , ä¾èµ–æ€§è‡ªç„¶è¡°å‡;
        > æ—‹è½¬è§’åº¦å·®è¶Šå¤§, ä¸¤ä¸ªå‘é‡çš„ç‚¹ç§¯è¶Šå°;
- **ä»£ç æ¼”ç¤º**:
    > [test_rope.py](./code/test_rope.py)
    - **ç›¸å¯¹æ€§éªŒè¯**: $\langle \text{RoPE}(q, m), \text{RoPE}(k, n) \rangle = \langle q, \text{RoPE}(k, m - n) \rangle$
        > $\text{RoPE}(vec, pos)$: å¯¹ä½äº $pos$ çš„å‘é‡ $vec$ æ—‹è½¬ $pos \cdot \theta$ åº¦; å¤šç»´æƒ…å†µéœ€ä¸¤ä¸¤åˆ†ç»„åè¿›è¡Œæ—‹è½¬ (è¯¦è§ä»£ç );
        ```txt
        === RoPE ç›¸å¯¹æ€§éªŒè¯ ===
        m    n    m-n    dot_val     ro_dot_val
        ----------------------------------------
        0    0    0      -4.081900   -4.081900
        4    4    0      -4.081900   -4.081900
        10   0    10     -2.769302   -3.336345
        15   5    10     -2.769302   -3.336345
        18   8    10     -2.769302   -3.336345
        6    16   -10    -3.336345   -2.769302
        16   26   -10    -3.336345   -2.769302
        3    13   -10    -3.336345   -2.769302
        ```
        - **ç›´è§‚è§£é‡Š**: å¯¹äºä¸¤ä¸ªç»è¿‡ RoPE æ—‹è½¬åçš„å‘é‡ $q_m$ (ä½äº $m$) å’Œ $k_n$ (ä½äº $n$), å®ƒä»¬çš„ç‚¹ç§¯ç»“æœåªä¸å®ƒä»¬çš„ç›¸å¯¹ä½ç½® $m-n$ æœ‰å…³, ä¸ç»å¯¹ä½ç½®æ— å…³;

## å‚è€ƒèµ„æ–™
- [è®¾è®¡ä½ç½®ç¼–ç  - HuggingFace Blog](https://huggingface.co/blog/zh/designing-positional-encoding)
- [è®©ç ”ç©¶äººå‘˜ç»å°½è„‘æ±çš„Transformerä½ç½®ç¼–ç  - ç§‘å­¦ç©ºé—´|Scientific Spaces](https://kexue.fm/archives/8130)
- [ååˆ†é’Ÿè¯»æ‡‚æ—‹è½¬ç¼–ç  (RoPE) - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/647109286)
    - [å†è®ºå¤§æ¨¡å‹ä½ç½®ç¼–ç åŠå…¶å¤–æ¨æ€§ (ä¸‡å­—é•¿æ–‡) - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/675243992)


### é¢è¯•é—®é¢˜æ•´ç†
> [ä½ç½®ç¼–ç é—®é¢˜æ•´ç†](./Transformeré¢è¯•é¢˜-ä½ç½®ç¼–ç .md)